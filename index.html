<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Aile Aƒüacƒ±</title><style>
        /* --- TEMEL TASARIM --- */
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        #tabs-container { background: #dfe6e9; padding: 5px 10px 0; display: flex; gap: 5px; height: 40px; align-items: flex-end; border-bottom: 1px solid #ccc; flex-shrink: 0; z-index: 1900; overflow-x: auto; }
        .tab { background: #b2bec3; color: white; padding: 8px 15px; border-radius: 8px 8px 0 0; font-size: 13px; font-weight: bold; cursor: pointer; border: 1px solid #95a5a6; border-bottom: none; min-width: 80px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; white-space: nowrap; }
        .tab.active { background: #fff; color: #2c3e50; border-top: 3px solid #3498db; position: relative; top: 1px; z-index: 10; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .tab-close { font-size: 14px; width: 18px; height: 18px; line-height: 16px; border-radius: 50%; background: rgba(0,0,0,0.2); color: white; display: inline-flex; align-items: center; justify-content: center; }
        .tab.home .tab-close { display: none; }
        
        #toolbar { background: #2c3e50; padding: 10px; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 2000; display: flex; align-items: center; justify-content: space-between; gap: 10px; overflow-x: auto; white-space: nowrap; height: 50px; flex-shrink: 0; }
        
        button, .btn-upload { cursor: pointer; padding: 8px 12px; border: none; border-radius: 4px; font-weight: bold; color: white; display: inline-flex; align-items: center; gap:5px; font-size: 12px; height: 32px; flex-shrink: 0; }
        
        .btn-blue { background: #2980b9; } .btn-red { background: #c0392b; } .btn-green { background: #27ae60; } 
        .btn-purple { background: #8e44ad; } .btn-pink { background: #e84393; } .btn-orange { background: #d35400; } 
        .btn-dark { background: #34495e; } .btn-cyan { background: #00bcd4; color: white; }
        .btn-gold { background: #f1c40f; color: #2c3e50; border: 2px solid #f39c12; }
        .btn-upload { background: #2980b9; margin: 0;} input[type="file"] { display: none; }
        
        /* --- MESAJ Sƒ∞STEMƒ∞ (YENƒ∞) --- */
        #msg-input { padding: 5px; border-radius: 4px; border: none; margin-left: 10px; width: 180px; font-size: 12px; color: #333; }
        
        /* B√ºy√ºk Mesaj Kutusu */
        #site-msg-display { 
            position: fixed; top: 60px; left: 20px; 
            background: rgba(255, 255, 255, 0.98); 
            padding: 15px 25px 15px 15px; 
            border-left: 5px solid #2980b9; 
            border-radius: 4px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
            z-index: 1800; 
            font-weight: 500; color: #333; 
            display: none; 
            max-width: 350px; font-size: 13px; line-height: 1.4;
            pointer-events: auto;
        }

        /* X Butonu */
        .msg-close-btn {
            position: absolute; top: 2px; right: 5px;
            background: none; border: none; color: #999;
            font-size: 16px; font-weight: bold; cursor: pointer;
            padding: 0 5px;
        }
        .msg-close-btn:hover { color: #c0392b; }

        /* Minik "Mesajƒ± Oku" Butonu (Mesaj kapanƒ±nca √ßƒ±kar) */
        #msg-reopen-btn {
            position: fixed; top: 60px; left: 10px;
            background: #3498db; color: white;
            padding: 8px 12px; border-radius: 20px;
            font-size: 12px; font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1799; cursor: pointer; display: none;
            border: 2px solid white;
        }
        #msg-reopen-btn:hover { background: #2980b9; }

        #viewport { flex: 1; overflow: hidden; position: relative; background: radial-gradient(#ccc 1px, transparent 1px); background-size: 20px 20px; cursor: default; touch-action: none; }
        #world { position: absolute; top: 0; left: 0; transform-origin: 0 0; transition: transform 0.1s linear; width: 100%; display: flex; justify-content: center; }
        
        .tree ul { padding-top: 25px; position: relative; display: flex; justify-content: center; pointer-events: none; }
        .tree li { float: left; text-align: center; list-style-type: none; position: relative; padding: 20px 5px 0 5px; pointer-events: none; }
        .tree li::before, .tree li::after { content: ''; position: absolute; top: 0; right: 50%; border-top: 2px solid #aaa; width: 50%; height: 20px; z-index: -1; pointer-events: none; }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #aaa; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #aaa; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        .tree ul ul::before { content: ''; position: absolute; top: 0; left: 50%; border-left: 2px solid #aaa; width: 0; height: 20px; z-index: -1; pointer-events: none; }
        
        .couple-wrapper { display: inline-flex; gap: 15px; align-items: flex-start; position: relative; padding: 10px; pointer-events: none; }
        .couple-wrapper.has-spouse::before { content: ''; position: absolute; top: 60px; left: 50%; transform: translateX(-50%); width: 20px; height: 2px; background: #999; z-index: -1; pointer-events: none; }
        
        /* KART TASARIMI */
        .card { 
            background: white; border: 1px solid #ccc; border-radius: 8px; 
            position: relative; z-index: 100; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            pointer-events: auto !important; user-select: none;
            
            width: 140px !important; min-width: 140px !important; max-width: 140px !important;
            height: 170px !important; min-height: 170px !important; max-height: 170px !important;
            padding: 10px 5px; box-sizing: border-box; overflow: hidden;
        }

        .card.male { background: #f0f8ff; border-color: #4682b4; } 
        .card.female { background: #fff0f5; border-color: #ff69b4; }
        .card.selected { border: 4px solid #2ecc71 !important; transform: scale(1.05); z-index: 110; box-shadow: 0 0 15px rgba(46, 204, 113, 0.5); }
        .card.deceased { background: #f0f0f0 !important; border-color: #777 !important; filter: grayscale(1); }
        .card.moving-source { border: 3px dashed #e67e22 !important; background: #fff3e0 !important; opacity:0.8; }
        
        .inspect-btn { position: absolute; top: -10px; left: -10px; width: 28px; height: 28px; background: #34495e; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); cursor: pointer; z-index: 200; }
        .portal-indicator { position: absolute; top: -10px; right: -10px; width: 28px; height: 28px; background: #27ae60; color: white; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 14px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); z-index: 200; cursor: pointer; }
        .portal-indicator::after { content: 'üå≥'; } .portal-indicator:hover { transform: scale(1.1); background: #2ecc71; } .card.has-portal .portal-indicator { display: flex; }
        .ribbon { position: absolute; top: -5px; right: -5px; font-size: 20px; display: none; z-index: 150; } .card.deceased .ribbon { display: block; } .card.has-portal.deceased .ribbon { right: 25px; } 
        
        .photo { width: 60px; height: 60px; background: rgba(255,255,255,0.5); border-radius: 50%; overflow: hidden; margin-bottom: 5px; border: 2px solid rgba(0,0,0,0.1); box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; pointer-events: none; flex-shrink: 0; }
        .photo img { width: 100%; height: 100%; object-fit: cover; }
        
        .name, .surname, .title, .info-row { width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; display: block; }
        .name { font-weight: 800; font-size: 13px; color: #2d3436; margin-bottom: 2px; }
        .surname { font-weight: 700; font-size: 11px; color: #2d3436; text-transform: uppercase; margin-bottom: 3px; }
        .title { font-size: 10px; color: #555; font-weight: 600; margin-bottom: 2px; }
        .info-row { font-size: 9px; color: #666; padding: 1px 0; }
        .note-preview { font-size: 9px; color: #888; background: rgba(255,255,255,0.5); padding: 2px; border-radius: 4px; margin-top: 2px; width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* --- MOBƒ∞L UYUMLULUK --- */
        @media only screen and (max-width: 768px) {
            .card { width: 110px !important; min-width: 110px !important; max-width: 110px !important; height: 140px !important; min-height: 140px !important; max-height: 140px !important; padding: 8px 2px; }
            .photo { width: 45px; height: 45px; margin-bottom: 2px; }
            .name { font-size: 10px; margin-bottom: 1px; } .surname { font-size: 9px; margin-bottom: 1px; }
            .title { font-size: 8px; margin-bottom: 1px; } .info-row { font-size: 8px; }
            .note-preview { display: none; }
            
            .inspect-btn, .portal-indicator { width: 22px; height: 22px; font-size: 10px; top: -8px; }
            .inspect-btn { left: -8px; } .portal-indicator { right: -8px; }
            .couple-wrapper.has-spouse::before { top: 40px; }
            
            #toolbar { height: 45px; gap: 3px; padding: 5px; }
            #toolbar button, .btn-upload { padding: 5px 8px; font-size: 10px; height: 28px; }
            #msg-input { width: 100px; font-size: 10px; height: 20px; }

            /* MOBƒ∞LDE MESAJ KUTUSU AYARI */
            #site-msg-display { top: 55px; left: 5%; width: 90%; max-width: none; font-size: 11px; padding: 10px 20px 10px 10px; box-sizing: border-box; }
            #msg-reopen-btn { top: 55px; left: 10px; padding: 6px 10px; font-size: 10px; }
        }

        #modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:6000; justify-content:center; align-items:center; backdrop-filter: blur(2px); }
        .modal-box { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 350px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; }
        .input-row { margin-bottom: 12px; } .input-row label { display: block; font-size: 12px; font-weight: bold; color: #555; margin-bottom: 4px; }
        .input-row input, .input-row textarea, .input-row select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-family: inherit; font-size: 16px; }
        .checkbox-container { display: flex; align-items: center; gap: 10px; background: #fff0f0; border: 1px solid #ffcccc; padding: 12px; border-radius: 8px; cursor: pointer; }
        .checkbox-container input { width: 20px; height: 20px; } .checkbox-container label { margin: 0; color: #c0392b; font-weight: bold; }
        .photo-gallery { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
        .mini-photo-wrapper { position: relative; } .mini-photo { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ccc; }
        .delete-mini { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: flex; justify-content: center; align-items: center; cursor: pointer; border: 1px solid white; }
        
        #bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 10px; display: flex; align-items: center; justify-content: space-between; z-index: 4900; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); box-sizing: border-box; }
        #zoom-range { flex: 1; margin: 0 15px; cursor: pointer; }
        #hand-mode-box { background: #f1c40f; padding: 8px 12px; border-radius: 8px; display: flex; align-items: center; gap: 8px; font-weight: bold; font-size: 13px; cursor: pointer; border: 2px solid #f39c12; }
        #hand-mode-box input { width: 18px; height: 18px; cursor: pointer; }
        .btn-focus { background: #e67e22; border: 2px solid #d35400; padding: 8px 12px; border-radius: 8px; color: white; font-weight: bold; font-size: 13px; cursor: pointer; margin-right: 10px; flex-shrink: 0;}
        
        #insta-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 7000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #insta-card { background: white; width: 90%; max-width: 380px; border-radius: 20px; overflow: hidden; position: relative; animation: pop 0.3s; }
        #insta-img-area { height: 300px; background: #222; display: flex; justify-content: center; align-items: center; position: relative; }
        #insta-img-area img { width: 100%; height: 100%; object-fit: contain; }
        .slide-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.3); color: white; border: none; padding: 10px; cursor: pointer; font-size: 20px; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; }
        .prev-btn { left: 10px; } .next-btn { right: 10px; }
        #insta-dots { position: absolute; bottom: 10px; display: flex; gap: 5px; } .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.5); border-radius: 50%; } .dot.active { background: white; }
        #insta-info { padding: 20px; max-height: 40vh; overflow-y: auto; }
        .info-block { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .info-label { font-size: 10px; font-weight: bold; color: #888; text-transform: uppercase; } .info-val { font-size: 15px; color: #222; font-weight: 600; }
        .close-insta { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; width: 35px; height: 35px; border-radius: 50%; border: none; font-size: 18px; cursor: pointer; z-index: 10; }
        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; color: white; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 20px; }
     #toolbar, #modal, #loading-overlay {display:none !important} /* ƒ∞ndirilen sitede mesaj varsa g√∂ster */ #site-msg-display { display: block; } #msg-reopen-btn { display: none; }</style></head><body><div id="tabs-container"></div><div id="site-msg-display"></div><button id="msg-reopen-btn" onclick="toggleMsg(true)">üí¨ Mesaj</button><div id="viewport"><div id="world"><div id="root" class="tree"></div></div></div><div id="bottom-bar"><button class="btn-focus" onclick="centerTree()">üéØ Merkeze D√∂n</button><label id="hand-mode-box"><input type="checkbox" id="hand-mode-toggle" onchange="toggleHandMode()">üñêÔ∏è Gezinme (El Modu)</label><span>üîç</span><input type="range" id="zoom-range" min="0.2" max="2.5" step="0.1" value="1"></div><div id="insta-overlay"><div id="insta-card"><button class="close-insta" onclick="document.getElementById('insta-overlay').style.display='none'">‚úï</button><div id="insta-img-area"><button class="slide-btn prev-btn" onclick="changeSlide(-1)">‚ùÆ</button><img id="insta-img" src=""><button class="slide-btn next-btn" onclick="changeSlide(1)">‚ùØ</button><div id="insta-dots" class="slide-dots"></div></div><div id="insta-info"></div></div></div><script>
    const INITIAL_DATA = {"trees":{"main":[{"id":1,"name":"BA≈ûLANGI√á","surname":"","gender":"male","title":"K√∂k","loc":"","note":"","birth":"","death":"","photos":[],"isDeceased":false,"spouse":null,"children":[]}]},"rootId":"main", "siteMessage": ""};
    let db = INITIAL_DATA; let openTabs = [{id:'main', name:'Ana Sayfa'}]; let currentTreeId = 'main'; let selId = null, selType = null, isMovingMode = false, movingSourceId = null; let tempPhotos = []; let currentSlide = 0;
    const vp = document.getElementById('viewport'); const world = document.getElementById('world'); const zoomRng = document.getElementById('zoom-range'); const handToggle = document.getElementById('hand-mode-toggle');
    let scale = 1, panning = false, pointX = 0, pointY = 0, startX = 0, startY = 0; let initialPinchDistance = 0; let initialScale = 1;

    function setTransform() { world.style.transform = `translate(${pointX}px, ${pointY}px) scale(${scale})`; zoomRng.value = scale; }
    rng=zoomRng; rng.addEventListener('mousedown',(e)=>e.stopPropagation()); rng.addEventListener('touchstart',(e)=>e.stopPropagation()); rng.oninput=(e)=>{scale=parseFloat(e.target.value);setTransform()};

    function centerTree() { const vpW = vp.offsetWidth; const vpH = vp.offsetHeight; let rootCard = document.querySelector("#root > ul > li > .couple-wrapper > .card");
        if (rootCard) { const rect = rootCard.getBoundingClientRect(); const currentCenterX = rect.left + rect.width / 2; const currentCenterY = rect.top + rect.height / 2; const targetX = vpW / 2; const targetY = 150; pointX += (targetX - currentCenterX); pointY += (targetY - rect.top); setTransform(); } 
        else { pointX = (vpW / 2) - 70; pointY = 50; setTransform(); } }
    function toggleHandMode() { if(!handToggle.checked) { vp.style.cursor='default'; } else { vp.style.cursor='grab'; } }

    vp.addEventListener('mousedown', (e) => { if(e.target.closest('.card') || e.target.closest('.inspect-btn') || e.target.closest('.portal-indicator') || e.target.closest('.msg-close-btn')) return; if(!handToggle.checked) return; panning=true; startX=e.clientX-pointX; startY=e.clientY-pointY; vp.style.cursor='grabbing'; });
    window.addEventListener('mousemove', (e) => { if(panning){ e.preventDefault(); pointX=e.clientX-startX; pointY=e.clientY-startY; setTransform(); } });
    window.addEventListener('mouseup', () => { panning=false; if(handToggle.checked) vp.style.cursor='grab'; else vp.style.cursor='default'; });
    vp.addEventListener('wheel', (e) => { if(!handToggle.checked) return; e.preventDefault(); const delta = -Math.sign(e.deltaY)*0.1; scale=Math.min(Math.max(scale+delta,0.2),2.5); setTransform(); }, {passive:false});
    vp.addEventListener('touchstart', (e) => { if(e.target.closest('.card') || e.target.closest('.inspect-btn') || e.target.closest('.portal-indicator') || e.target.closest('.msg-close-btn')) return; if(e.touches.length === 2) { panning = false; initialPinchDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY); initialScale = scale; } else if(e.touches.length === 1 && handToggle.checked){ panning=true; startX = e.touches[0].clientX - pointX; startY = e.touches[0].clientY - pointY; } }, {passive: false});
    window.addEventListener('touchmove', (e) => { if (e.touches.length === 2 && initialPinchDistance > 0) { e.preventDefault(); const currentDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY); const ratio = currentDistance / initialPinchDistance; scale = Math.min(Math.max(initialScale * ratio, 0.2), 2.5); setTransform(); } else if(panning && e.touches.length === 1){ e.preventDefault(); pointX = e.touches[0].clientX - startX; pointY = e.touches[0].clientY - startY; setTransform(); } }, {passive: false});
    window.addEventListener('touchend', () => { panning=false; initialPinchDistance = 0; });

    window.onload = function() { try { let raw = "eyJ0cmVlcyI6eyJtYWluIjpbeyJpZCI6MTc2OTUzOTIxMjkzNywibmFtZSI6IsOWbWVyIiwic3VybmFtZSI6IktpbmRpeWV2IiwiZ2VuZGVyIjoibWFsZSIsInRpdGxlIjoiR8O8cmNpc3RhbiAoQXjEsXN4YSBTYWt1bmV0KSAvIEF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSIsImxvYyI6IlVsdSBkZWRlIiwibm90ZSI6IiIsImJpcnRoIjoiMTAuMDEuMTkwMiIsImRlYXRoIjoiIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL09tYXJEZWRlLmpwZWciXSwiaXNEZWNlYXNlZCI6dHJ1ZSwic3BvdXNlIjp7ImlkIjoxNzY5NjI5ODY1NTg0LCJuYW1lIjoiVmF5ZGUiLCJzdXJuYW1lIjoiS2luZGl5ZXZhIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1ZheWRlTmVuZS5qcGVnIl0sInRpdGxlIjoiVWx1IG5lbmUiLCJsb2MiOiJHw7xyY2lzdGFuIChBeMSxc3hhIFNha3VuZXQpIiwibm90ZSI6IiIsImJpcnRoIjoiMDEuMDcuMTkwMyIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6dHJ1ZX0sImNoaWxkcmVuIjpbeyJpZCI6MSwibmFtZSI6Iktpcm1hbiIsInN1cm5hbWUiOiJLaW5kaXlldiIsImdlbmRlciI6Im1hbGUiLCJ0aXRsZSI6IiIsImxvYyI6IkfDvHJjaXN0YW4gKFNhYmlyYWJhZCBBeMSxc3hhKSAvIEF6ZXJiYXljYW4gKEF4xLFzeGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMjAuMTEuMTkzNyIsImRlYXRoIjoiIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL2RlZGUxLmpwZWciLCJmb3RvZ3JhZmxhci9kZWRlMi5qcGVnIiwiZm90b2dyYWZsYXIvZGVkZTMuanBlZyIsImZvdG9ncmFmbGFyL2RlZGU0LmpwZWciXSwiaXNEZWNlYXNlZCI6dHJ1ZSwic3BvdXNlIjp7ImlkIjoxNzY5NTM4OTM5OTQyLCJuYW1lIjoiQXNsxLEgKFB1bnB1bCkiLCJzdXJuYW1lIjoiS2luZGl5ZXZhIChNZWNpZG92YSkiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvbmVuZTEuanBlZyIsImZvdG9ncmFmbGFyL25lbmUyLmpwZWciLCJmb3RvZ3JhZmxhci9uZW5lMy5qcGVnIl0sInRpdGxlIjoiTmVuZSIsImxvYyI6IsOWemJlcmtpc3RhbiAvIEF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjEzLjA4LjE5NDgiLCJkZWF0aCI6IjMwLjA4LjIwMTkiLCJpc0RlY2Vhc2VkIjp0cnVlfSwiY2hpbGRyZW4iOlt7ImlkIjoxNzY5NTM5MDUyMjEyLCJuYW1lIjoiRWxtYW4iLCJzdXJuYW1lIjoiS2luZGl5ZXYiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0VsbWFuRW1pLmpwZWciXSwiY2hpbGRyZW4iOlt7ImlkIjoxNzY5NTQxOTAxODM4LCJuYW1lIjoiRW52ZXIgKEVub8WfKSIsInN1cm5hbWUiOiLDlm1lciAoS2luZGl5ZXYpICIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvRW5vc0VtaS5qcGVnIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiJBbWNhIG/En2x1IiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIC8gVMO8cmtpeWUgQnVyc2EiLCJub3RlIjoiIiwiYmlydGgiOiIyMS4wNS4xOTk1IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX0seyJpZCI6MTc2OTU0MTkwMzA3MCwibmFtZSI6IlZhaGlkZSAoS8SxemkpIiwic3VybmFtZSI6IsOWbWVyIChLaW5kaXlldikiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvS2l6aUJhY2kuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiQW1jYSBrxLF6xLEiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBUw7xya2l5ZSBCdXJzYSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjA4LjAzLjE5OTciLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfV0sInRpdGxlIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIiwibG9jIjoiRW1pIiwibm90ZSI6IiIsImJpcnRoIjoiMTkuMDYuMTk2NyIsImRlYXRoIjoiMjIuMDYuMjAwMiIsImlzRGVjZWFzZWQiOnRydWUsInNwb3VzZSI6eyJpZCI6MTc2OTU0MTY0MzA3NywibmFtZSI6IkfDvGxuYXJhIiwic3VybmFtZSI6IsOWbWVyICIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9HdWxuYXJhQmliaTEuanBlZyJdLCJ0aXRsZSI6IiIsImxvYyI6IkF6ZXJiYXljYW4gKEF4xLFzYXhhKSAvIFTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIwNC4wMy4xOTY0IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX19LHsiaWQiOjE3Njk1MzkwNTIwNTMsIm5hbWUiOiJFbHhhbiIsInN1cm5hbWUiOiJLaW5kaXlldiIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvRWxoYW5FbWkuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NDExNDMzODEsIm5hbWUiOiJSaXNpeWEiLCJzdXJuYW1lIjoiS2luZGl5ZXZhIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1Jpc2l5YUJhY2kuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiRW1pIGvEsXrEsSIsImxvYyI6IlJ1c3lhICjDh2l0YSkiLCJub3RlIjoiIiwiYmlydGgiOiIiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfSx7ImlkIjoxNzY5NTQxMTQzNzAxLCJuYW1lIjoiWXVseWEiLCJzdXJuYW1lIjoiS2luZGl5ZXZhIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1l1bHlhQmFjaS5qcGVnIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiJFbWkga8SxesSxIiwibG9jIjoiUnVzeWEgKMOHaXRhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IiIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9XSwidGl0bGUiOiJFbWkiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBSdXN5YSAow4dpdGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMTEuMDEuMTk3MCIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2UsInNwb3VzZSI6eyJpZCI6MTc2OTU0MTY0OTU4NSwibmFtZSI6IkfDtnplbCIsInN1cm5hbWUiOiJLaW5kaXlldmEiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvLkpQRUciXSwidGl0bGUiOiIiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBSdXN5YSAow4dpdGEpIiwibm90ZSI6IiIsImJpcnRoIjoiIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX19LHsiaWQiOjE3Njk1MzkwNTIzNjIsIm5hbWUiOiJFbMWfYW4iLCJzdXJuYW1lIjoiS2luZGl5ZXYiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0Vsc2FuRW1pMS5qcGVnIiwiZm90b2dyYWZsYXIvRWxzYW5FbWkyLmpwZWciLCJmb3RvZ3JhZmxhci9FbHNhbkVtaTMuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NDE4MzA0MzUsIm5hbWUiOiJKYWxlIiwic3VybmFtZSI6IktpbmRpeWV2YSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9KYWxlQmFjaS5qcGVnIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiIiLCJsb2MiOiJSdXN5YSAoTXVybWFuc2spIC8gVMO8cmtpeWUgKEJ1cnNhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IiIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9XSwidGl0bGUiOiJFbWkiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBSdXN5YSAoTXVybWFuc2spIiwibm90ZSI6IiIsImJpcnRoIjoiMTAuMDEuMTk3MiIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2UsInNwb3VzZSI6eyJpZCI6MTc2OTU0MTY0NzEwMywibmFtZSI6IkFsbWF6Iiwic3VybmFtZSI6IktpbmRpeWV2YSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci8uSlBFRyJdLCJ0aXRsZSI6IiIsImxvYyI6IkF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSAvIFJ1c3lhIChNdXJtYW5zaykiLCJub3RlIjoiIiwiYmlydGgiOiIiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX0seyJpZCI6MTc2OTUzOTA1MjUzMywibmFtZSI6IkFza2VyIiwic3VybmFtZSI6IsOWbWVyIChLaW5kaXlldikiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0Fza2VyRW1pMS5qcGVnIiwiZm90b2dyYWZsYXIvQXNrZXJFbWkyLmpwZWciLCJmb3RvZ3JhZmxhci9Bc2tlckVtaTMuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NDE4NTY3MjEsIm5hbWUiOiJFYnViZWtpciAiLCJzdXJuYW1lIjoiw5ZtZXIgKEtpbmRpeWV2KSIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvRWJ1YmVraXJBYmkuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiQmliaSBvxJ9sdSIsImxvYyI6IlTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIwMy4wMi4yMDAwIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZSwic3BvdXNlIjp7ImlkIjoxNzY5NTUxMzQ3MjMzLCJuYW1lIjoiPyIsInN1cm5hbWUiOiLDlm1lciIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9ZZW5nZS5wbmciXSwidGl0bGUiOiJZZW5nZSIsImxvYyI6IlTDvHJraXllIiwibm90ZSI6Iig6IiwiYmlydGgiOiI/PyIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9fSx7ImlkIjoxNzY5NTQxODU4MjI1LCJuYW1lIjoiRG/En2FuIiwic3VybmFtZSI6IsOWbWVyIChLaW5kaXlldikiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0RvZ2FuLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IkVtaSBvxJ9sdSIsImxvYyI6IlTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIxMy4wOS4yMDA4IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX1dLCJ0aXRsZSI6IkVtaSIsImxvYyI6IkF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSAvIFTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIyMy4wMi4xOTc0IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZSwic3BvdXNlIjp7ImlkIjoxNzY5NTQxNjUyMTI1LCJuYW1lIjoiTmVyZ2l6Iiwic3VybmFtZSI6IsOWbWVyIChTZWZlcikiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvTmVyZ2l6QmliaS5qcGVnIl0sInRpdGxlIjoiIiwibG9jIjoiw5Z6YmVraXN0YW4gKEZlcmdhbmEpIC8gVMO8cmtpeWUgKEJ1cnNhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjIwLjEyLjE5ODEiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX0seyJpZCI6MTc2OTUzOTA1MjY3NSwibmFtZSI6IkFyYXoiLCJzdXJuYW1lIjoiS2luZGl5ZXYiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0JhYmExLmpwZWciLCJmb3RvZ3JhZmxhci9CYWJhMi5qcGVnIiwiZm90b2dyYWZsYXIvQmFiYTMuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NDE5MDUxMzAsIm5hbWUiOiJEZXJ5YSIsInN1cm5hbWUiOiJLaW5kaXlldmEiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvQmFjaTEuanBlZyIsImZvdG9ncmFmbGFyL0JhY2kyLmpwZWciLCJmb3RvZ3JhZmxhci9CYWNpMy5qcGVnIiwiZm90b2dyYWZsYXIvQmFjaTQuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIC8gVMO8cmtpeWUgKEJ1cnNhKSkiLCJub3RlIjoiIiwiYmlydGgiOiIwNS4wOC4yMDA2IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX0seyJpZCI6MTc2OTU0MTkwNjEzMCwibmFtZSI6IkRlbml6Iiwic3VybmFtZSI6IktpbmRpeWV2IiwiZ2VuZGVyIjoibWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9CZW4uanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiQmVuICg6IiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEgKSAvIFTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIwMS4wMS4yMDA4IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX1dLCJ0aXRsZSI6IkJhYmEiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgIiwibm90ZSI6IiIsImJpcnRoIjoiMjAuMDMuMTk4NSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2UsInNwb3VzZSI6eyJpZCI6MTc2OTU0MTY1NDQwMCwibmFtZSI6IkfDvGzDp8O2aHJlIChHw7zDp2kpIiwic3VybmFtZSI6IktpbmRpeWV2YSAoTWFobXVkb3ZhKSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9BYmExLmpwZWciLCJmb3RvZ3JhZmxhci9BYmEyLmpwZWciLCJmb3RvZ3JhZmxhci9BYmEzLmpwZWciXSwidGl0bGUiOiJBbmEiLCJsb2MiOiLDlnpiZWtpc3RhbiAvQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMDMuMDUuMTk4NSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9fSx7ImlkIjoxNzY5NTM5MzU0NzYyLCJuYW1lIjoixZ5lbGFsZSAiLCJzdXJuYW1lIjoiQWtpZiAoS2luZGl5ZXZhKSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9TYWxhQmliaS5wbmciXSwiY2hpbGRyZW4iOlt7ImlkIjoxNzY5NTQxOTI1MjE2LCJuYW1lIjoiw5xsZmVuIiwic3VybmFtZSI6IkFraWYiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1VsZmFuQWJpLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IkJpYmkgb8SfbHUiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBUw7xya2l5ZSAoQnVyc2EpKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjMwLjEwLjE5OTMiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfSx7ImlkIjoxNzY5NTQxOTI3MTUwLCJuYW1lIjoiU3V6YW5hIiwic3VybmFtZSI6IkVtaXIgKEFraWYpIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1N1emFuQWJsYS5qcGVnIl0sImNoaWxkcmVuIjpbeyJpZCI6MTc2OTU0NjEwNTkyMCwibmFtZSI6IllpxJ9pdCBBbGkgIiwic3VybmFtZSI6IkVtaXIiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL1lpZ2l0LmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IiIsImxvYyI6IlTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIwOS4wMy4yMDIwIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX1dLCJ0aXRsZSI6IkJpYmkga8SxesSxIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIC8gVMO8cmtpeWUgKEJ1cnNhKSkiLCJub3RlIjoiIiwiYmlydGgiOiIxMi4wMy4xOTk1IiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZSwic3BvdXNlIjp7ImlkIjoxNzY5NTQ2MDA4OTg5LCJuYW1lIjoiQmFoYWTEsXIiLCJzdXJuYW1lIjoiRW1pciIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvQmFoYWRpci5qcGVnIl0sInRpdGxlIjoiIiwibG9jIjoiVMO8cmtpeWUgKEJ1cnNhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjE1LjEyLjE5ODgiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX0seyJpZCI6MTc2OTU0MTkyODMwNywibmFtZSI6IkVsemFyYSAoRXppKSIsInN1cm5hbWUiOiJBa2lmIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0VsemFyYUJhY2kuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiQmliaSBrxLF6xLEiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBUw7xya2l5ZSAoQnVyc2EpKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjA4LjAxLjIwMDAiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfV0sInRpdGxlIjoiQmliaSIsImxvYyI6IkF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSAvIFTDvHJraXllIChCdXJzYSkpIiwibm90ZSI6IiIsImJpcnRoIjoiMTAuMTAuMTk3NiIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9LHsiaWQiOjE3Njk1MzkzNTQ5MjksIm5hbWUiOiJMZXlsYSAiLCJzdXJuYW1lIjoiU2FpZG92YSAoS2luZGl5ZXZhKSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9CaWJpMS5qcGVnIiwiZm90b2dyYWZsYXIvQmliaTIuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NDE5MTgzNDUsIm5hbWUiOiJGaWRhbiIsInN1cm5hbWUiOiJLYWRpcmxpIChTYWlkb3ZhKSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9GaWRhbkJhY2kuanBlZyJdLCJjaGlsZHJlbiI6W3siaWQiOjE3Njk1NTA4MTQyMTYsIm5hbWUiOiJIaWxhbCIsInN1cm5hbWUiOiJLYWRpcmxpIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0hpbGFsLnBuZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMzEuMDUuMjAxOSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9LHsiaWQiOjE3Njk1NTA4MTQ3ODIsIm5hbWUiOiJNYXZpICIsInN1cm5hbWUiOiJLYWRpcmxpIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL01hdmkucG5nIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiIiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkiLCJub3RlIjoiIiwiYmlydGgiOiIwNS4wMy4yMDIxIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX0seyJpZCI6MTc2OTU1MDgxNjM0MSwibmFtZSI6Ik1lbGlzYSIsInN1cm5hbWUiOiJLYWRpcmxpIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL3BlbmJlLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IiIsImxvYyI6IkF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjA4LjEwLjIwMjUiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfV0sInRpdGxlIjoiQmliaSBrxLF6xLEiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkiLCJub3RlIjoiIiwiYmlydGgiOiIxNC4xMi4yMDAwIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZSwic3BvdXNlIjp7ImlkIjoxNzY5NTQ2NTMyODAwLCJuYW1lIjoixLBsa2luIiwic3VybmFtZSI6IkthZGlybGkiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL2lsa2luLnBuZyJdLCJ0aXRsZSI6IiIsImxvYyI6IkF6ZXJiYXljYW4gKFNhYmlyYWJhZCBBeMSxc3hhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjI4LjAzLjE5OTMiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX0seyJpZCI6MTc2OTU0MTkxOTYyNCwibmFtZSI6IkF5ZGFuIiwic3VybmFtZSI6IlNhaWRvdmEiLCJnZW5kZXIiOiJmZW1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvQXlkYW5BYmxhLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IkJpYmkga8SxesSxIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIC8gVMO8cmtpeWUgKEJ1cnNhKSkiLCJub3RlIjoiIiwiYmlydGgiOiIwMi4wMy4yMDAyIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX0seyJpZCI6MTc2OTU0MTkyMDgyMywibmFtZSI6IsOHaWRlbSIsInN1cm5hbWUiOiJTYWlkb3ZhIiwiZ2VuZGVyIjoiZmVtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0NpZGVtLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IkJpYmkga8SxesSxIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMDUuMDYuMjAwOSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9LHsiaWQiOjE3Njk1NDE5MjE2ODcsIm5hbWUiOiJBcmRhIiwic3VybmFtZSI6IlNhaWRvdiIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvQXJkYS5qcGVnIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiJCaWJpIG/En2x1IiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpIiwibm90ZSI6IiIsImJpcnRoIjoiMDIuMDMuMjAxNSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9XSwidGl0bGUiOiJCaWJpIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpICIsIm5vdGUiOiIiLCJiaXJ0aCI6IjI3LjA5LjE5NzkiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlLCJzcG91c2UiOnsiaWQiOjE3Njk1NDYyMDIyOTYsIm5hbWUiOiJUZXltdXIiLCJzdXJuYW1lIjoiU2FpZG92IiwiZ2VuZGVyIjoibWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9UZXltdXJFbWkucG5nIl0sInRpdGxlIjoiIiwibG9jIjoiQXplcmJheWNhbiAoU2FiaXJhYmFkIEF4xLFzeGEpICIsIm5vdGUiOiIiLCJiaXJ0aCI6IjAxLjA4LjE5NzQiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX0seyJpZCI6MTc2OTUzOTM1NTc5MiwibmFtZSI6IkxhbGUgKFN2ZXRhKSIsInN1cm5hbWUiOiJSZXN1bCAoS2luZGl5ZXZhKSIsImdlbmRlciI6ImZlbWFsZSIsInBob3RvcyI6WyJmb3RvZ3JhZmxhci9TdmV0YUJpYmkucG5nIl0sImNoaWxkcmVuIjpbeyJpZCI6MTc2OTU0MTkxNDEwOSwibmFtZSI6IkNhbiIsInN1cm5hbWUiOiJSZXN1bCIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvQ2FuMS5qcGVnIiwiZm90b2dyYWZsYXIvQ2FuMi5qcGVnIl0sImNoaWxkcmVuIjpbXSwidGl0bGUiOiJCaWJpIG/En2x1IiwibG9jIjoiVMO8cmtpeWUgKEJ1cnNhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjA1LjA5LjIwMDciLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfSx7ImlkIjoxNzY5NTQxOTE1MDE3LCJuYW1lIjoiQ2FuZXIiLCJzdXJuYW1lIjoiUmVzdWwiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0NhbmVyLmpwZWciXSwiY2hpbGRyZW4iOltdLCJ0aXRsZSI6IkJpYmkgb8SfbHUiLCJsb2MiOiJUw7xya2l5ZSAoQnVyc2EpIiwibm90ZSI6IiIsImJpcnRoIjoiMjUuMDUuMjAxMSIsImRlYXRoIjoiIiwiaXNEZWNlYXNlZCI6ZmFsc2V9LHsiaWQiOjE3Njk1NDE5MTU3MDIsIm5hbWUiOiJUYW5lciIsInN1cm5hbWUiOiJSZXN1bCIsImdlbmRlciI6Im1hbGUiLCJwaG90b3MiOlsiZm90b2dyYWZsYXIvVGFuZXIuanBlZyJdLCJjaGlsZHJlbiI6W10sInRpdGxlIjoiQmliaSBvxJ9sdSIsImxvYyI6IlTDvHJraXllIChCdXJzYSkiLCJub3RlIjoiIiwiYmlydGgiOiIyMy4wOC4yMDEyIiwiZGVhdGgiOiIiLCJpc0RlY2Vhc2VkIjpmYWxzZX1dLCJ0aXRsZSI6IkJpYmkiLCJsb2MiOiJBemVyYmF5Y2FuIChTYWJpcmFiYWQgQXjEsXN4YSkgLyBUw7xya2l5ZSAoQnVyc2EpKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjEwLjIxLjE5ODEiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlLCJzcG91c2UiOnsiaWQiOjE3Njk1Mzk3MjEzNzgsIm5hbWUiOiJBeWTEsW4iLCJzdXJuYW1lIjoiUmVzdWwiLCJnZW5kZXIiOiJtYWxlIiwicGhvdG9zIjpbImZvdG9ncmFmbGFyL0F5ZGluRW1pLmpwZWciXSwidGl0bGUiOiIiLCJsb2MiOiLDlnpiZWtpc3RhbiAoQW5kxLFjYW4pIC8gVMO8cmtpeWUgKEJ1cnNhKSIsIm5vdGUiOiIiLCJiaXJ0aCI6IjI3LjA1LjE5ODEiLCJkZWF0aCI6IiIsImlzRGVjZWFzZWQiOmZhbHNlfX1dfV19XX0sInJvb3RJZCI6Im1haW4iLCJzaXRlTWVzc2FnZSI6IlwiTWVyaGFiYSwgc295IGHEn2FjxLFtxLF6xLEgaW5jZWxlbWV5ZSBnZWxlbmxlciEgQnVyYWRhIGtlbmRpbml6aSB2ZSBha3JhYmFsYXLEsW7EsXrEsSBidWxhYmlsaXJzaW5pei4gRcSfZXIgYmlyIHllcmRlIHlhbmzEscWfbMSxayB2YXJzYSB2ZXlhIHllbmkgYmlyaW5pIGVrbGVtZWsgaXN0ZXJzZW5peiwgYmFuYSAwNTMwIDAyOCA4NyA3MSAoRGVuaXopIG51bWFyYXPEsW5kYW4gdWxhxZ9hYmlsaXJzaW5pei4gWWVuaSBracWfaWxlciBla2xlbmRpxJ9pbmRlIGfDtnJtZWsgacOnaW4gc2l0ZXlpIHlpbmUgeml5YXJldCBldG1lbml6aSDDtm5lcmlyaW0uIFRlxZ9la2vDvHJsZXIhXCIoOiJ9"; db = JSON.parse(decodeURIComponent(escape(atob(raw)))); } catch(e) { db = INITIAL_DATA; } if(db.siteMessage){ let box=document.getElementById('site-msg-display'); box.innerHTML='<button class="msg-close-btn" onclick="toggleMsg(false)">‚úï</button>'+db.siteMessage; box.style.display='block'; } setTimeout(function(){ loadTree('main'); centerTree(); }, 100); };

    function updateMsg(val) {
        db.siteMessage = val;
        // Y√∂netici panelinde sadece deƒüeri g√ºncelle, g√∂r√ºn√ºm√º manuel yapmayacaƒüƒ±z (indirilen sitede olacak)
        doFinal();
        // Ancak y√∂netici panelinde de test etmek i√ßin g√∂ster:
        toggleMsg(true);
    }

    // --- A√á/KAPA Sƒ∞STEMƒ∞ ---
    function toggleMsg(show) {
        const box = document.getElementById('site-msg-display');
        const btn = document.getElementById('msg-reopen-btn');
        if(!db.siteMessage) { box.style.display='none'; btn.style.display='none'; return; }

        if (show) {
            box.innerHTML = `<button class="msg-close-btn" onclick="toggleMsg(false)">‚úï</button>` + db.siteMessage;
            box.style.display = 'block';
            btn.style.display = 'none';
        } else {
            box.style.display = 'none';
            btn.style.display = 'block';
        }
    }

    function loadTree(tid) { if (!db.trees[tid]) tid = 'main'; currentTreeId = tid; refresh(); updateTabs(); }
    function refresh() { let rootNode = db.trees[currentTreeId][0]; document.getElementById('root').innerHTML = "<ul>" + build(rootNode) + "</ul>"; updateTabs(); document.getElementById('controls').style.display = selId ? 'flex' : 'none'; let moveBtn = document.getElementById('btn-move'); if(isMovingMode) { moveBtn.style.background='#e67e22'; moveBtn.innerText='ƒ∞PTAL ET'; } else { moveBtn.style.background='#34495e'; moveBtn.innerText='‚áÑ Deƒüi≈ütir'; } if(selId) { let p = getType(selId, selType); if(p) { document.getElementById('sel-name').innerText = p.name; document.getElementById('sel-name').style.display='inline'; let treeBtn = document.getElementById('btn-tree-action'); let delTreeBtn = document.getElementById('btn-delete-tree'); if(db.trees['tree_' + p.id]) { treeBtn.innerText = "üå≤ Aƒüacƒ± G√∂r√ºnt√ºle"; treeBtn.className = "btn-green"; treeBtn.style.display = "inline-flex"; delTreeBtn.style.display = 'inline-flex'; } else { treeBtn.innerText = "‚ûïüå≥ Yeni Aƒüa√ß Olu≈ütur"; treeBtn.className = "btn-purple"; treeBtn.style.display = "inline-flex"; delTreeBtn.style.display = 'none'; } } } let parentBtn = document.getElementById('btn-parent'); if(selId && selType === 'main' && rootNode && rootNode.id === selId) parentBtn.style.display = 'inline-flex'; else parentBtn.style.display = 'none'; }
    function updateTabs() { const c = document.getElementById('tabs-container'); c.innerHTML=''; openTabs.forEach((t,i) => { let d = document.createElement('div'); d.className='tab '+(t.id===currentTreeId?'active':'') + (t.id==='main'?' home':''); let sp = document.createElement('span'); sp.innerText=t.name; sp.onclick=()=>{if(currentTreeId!==t.id){ curId=t.id; selId=null; moveMode=false; loadTree(t.id); }}; d.appendChild(sp); if(t.id!=='main'){ let x = document.createElement('span'); x.className='tab-close'; x.innerText='‚úï'; x.onclick=(e)=>{ e.stopPropagation(); openTabs.splice(i,1); if(t.id===currentTreeId) loadTree(openTabs[i-1] ? openTabs[i-1].id : 'main'); else updateTabs(); }; d.appendChild(x); } c.appendChild(d); }); }
    function build(n) { if(!n) return ""; let h = `<li><div class="couple-wrapper ${n.spouse?'has-spouse':''}">${createCard(n,'main')}${n.spouse?createCard(n.spouse,'spouse',n.id):''}</div>`; if(n.children && n.children.length>0) { h+="<ul>"; n.children.forEach(c=>h+=build(c)); h+="</ul>"; } return h+"</li>"; }
    function createCard(p, type, pid=null) { let id = type==='main'?p.id:pid; let isS = (selId===id && selType===type); let ic = p.gender==='female'?'üë©':'üë®'; let movingClass = (isMovingMode && movingSourceId === p.id && type === 'main') ? 'moving-source' : ''; if(!p.photos) p.photos = p.photo ? [p.photo] : []; let mainPhoto = p.photos.length > 0 ? p.photos[0] : null; let hasTree = db.trees['tree_'+p.id] ? 'has-portal' : ''; return `<div class="card ${p.gender} ${p.isDeceased?'deceased':''} ${isS?'selected':''} ${movingClass} ${hasTree}" onclick="cardClick(event, ${id}, '${type}')"><div class="inspect-btn" onclick="showInsta(event, ${id}, '${type}')">üëÅÔ∏è</div><div class="ribbon">üéóÔ∏è</div><div class="portal-indicator" onclick="enterPortalDirect(event, ${id}, '${type}')"></div><div class="photo">${mainPhoto?`<img src="${mainPhoto}">`:`<span style="font-size:30px">${ic}</span>`}</div><span class="name">${p.name}</span><span class="surname">${p.surname||''}</span><span class="title">${p.title||''}</span>${p.loc?`<span class="info-row">üìç ${p.loc}</span>`:''}${(p.birth||p.death)?`<span class="info-row">${p.birth||'?'} - ${p.death||'?'}</span>`:''}${p.note?`<div class="note-preview">üìù ${p.note}</div>`:''}</div>`; }
    function cardClick(e, id, type) { if(e.target.classList.contains('inspect-btn') || e.target.classList.contains('portal-indicator')) return; e.stopPropagation(); panning = false; if(isMovingMode && type === 'main') performMove(id); else { selId=id; selType=type; refresh(); } }
    function enterPortalDirect(e, id, type) { e.stopPropagation(); let p = getType(id, type); let key = 'tree_' + p.id; if(db.trees[key]) { if(!openTabs.find(x=>x.id===key)) openTabs.push({id:key, name:p.name}); loadTree(key); } else { alert("Bu ki≈üinin bir aƒüacƒ± yok. √ñnce olu≈üturmalƒ±sƒ±n."); } }
    function startMove() { if (!selId || selType !== 'main') { alert("Ana ki≈üiyi se√ß."); return; } let p = find(db.trees[currentTreeId][0], selId); if(p.id === db.trees[currentTreeId][0].id) { alert("K√∂k ta≈üƒ±namaz."); return; } isMovingMode = !isMovingMode; movingSourceId = isMovingMode ? selId : null; refresh(); }
    function performMove(targetId) { if(targetId === movingSourceId) { isMovingMode=false; movingSourceId=null; refresh(); return;} let p1 = findParent(db.trees[currentTreeId][0], movingSourceId); let p2 = findParent(db.trees[currentTreeId][0], targetId); if(!p1 || !p2 || p1.id !== p2.id) { alert("Sadece karde≈üler."); isMovingMode=false; movingSourceId=null; refresh(); return; } let i1 = p1.children.findIndex(c => c.id === movingSourceId); let i2 = p1.children.findIndex(c => c.id === targetId); [p1.children[i1], p1.children[i2]] = [p1.children[i2], p1.children[i1]]; isMovingMode = false; selId = null; movingSourceId=null; doFinal(); }
    function handleTreeAction() { if(!selId) return; let p = getType(selId, selType); let key = 'tree_' + p.id; if(db.trees[key]) { if(!openTabs.find(x=>x.id===key)) openTabs.push({id:key, name:p.name}); loadTree(key); } else { if(confirm(p.name + " i√ßin yeni bir soy aƒüacƒ± olu≈üturulsun mu?")) { db.trees[key] = [{id:Date.now(), name:p.name, surname:p.surname, gender:p.gender, title:"K√∂k", loc:"", note:"", birth:"", death:"", photos:[], isDeceased:false, spouse:null, children:[]}]; if(!openTabs.find(x=>x.id===key)) openTabs.push({id:key, name:p.name}); doFinal(); loadTree(key); } } }
    function deleteCurrentTree() { if(!selId) return; let p = getType(selId, selType); let key = 'tree_' + p.id; if(!db.trees[key]) return; let treeRoot = db.trees[key][0]; let isFull = (treeRoot.children && treeRoot.children.length > 0) || (treeRoot.spouse); if(isFull) { if(!confirm("Bu aƒüa√ß dolu. Silmek istediƒüine emin misin?")) return; } delete db.trees[key]; let tabIndex = openTabs.findIndex(t => t.id === key); if(tabIndex !== -1) openTabs.splice(tabIndex, 1); if(currentTreeId === key) loadTree('main'); else { doFinal(); refresh(); } }
    function deleteNode(){ if(!selId) { alert("Kimse se√ßili deƒüil!"); return; } if(confirm("Bu ki≈üiyi silmek istediƒüine emin misin?")){ if(selType==='spouse') { let p = getP(selId, 'main'); if(p) p.spouse = null; } else { let treeRoot = db.trees[currentTreeId][0]; if(selId == treeRoot.id) { alert("K√∂k ki≈üi (Ba≈ülangƒ±√ß) silinemez!"); return; } let par = findParent(treeRoot, selId); if(par) { par.children = par.children.filter(x => x.id != selId); } else { alert("Hata: Ki≈üi bulunamadƒ±."); return; } } selId=null; doFinal(); } }
    function showInsta(e, id, type) { e.stopPropagation(); let p = getType(id, type); activePersonPhotos = p.photos && p.photos.length > 0 ? p.photos : []; currentSlide = 0; updateSlideShow(); let html = `<h1 style="margin:0">${p.name} ${p.surname||''}</h1>`; if(p.title) html += infoBox("√úNVAN", p.title); if(p.loc) html += infoBox("KONUM", p.loc); if(p.birth||p.death) html += infoBox("TARƒ∞H", (p.birth||'?') + " - " + (p.death||'?')); if(p.note) html += infoBox("NOTLAR", p.note); document.getElementById('insta-info').innerHTML = html; document.getElementById('insta-overlay').style.display='flex'; }
    function updateSlideShow() { let img = document.getElementById('insta-img'); let dots = document.getElementById('insta-dots'); dots.innerHTML = ""; if (activePersonPhotos.length === 0) { img.style.display = 'none'; } else { img.style.display = 'block'; img.src = activePersonPhotos[currentSlide]; activePersonPhotos.forEach((_, idx) => { let d = document.createElement('div'); d.className = 'dot ' + (idx === currentSlide ? 'active' : ''); dots.appendChild(d); }); } document.querySelector('.prev-btn').style.display = activePersonPhotos.length > 1 ? 'flex' : 'none'; document.querySelector('.next-btn').style.display = activePersonPhotos.length > 1 ? 'flex' : 'none'; }
    function changeSlide(dir) { if (activePersonPhotos.length <= 1) return; currentSlide += dir; if (currentSlide < 0) currentSlide = activePersonPhotos.length - 1; if (currentSlide >= activePersonPhotos.length) currentSlide = 0; updateSlideShow(); }
    function infoBox(l,v){ return `<div class="info-block"><div class="info-label">${l}</div><div class="info-val">${v}</div></div>`; }
    function addParent() { if(!selId || selType !== 'main') return; let currentRoot = db.trees[currentTreeId][0]; if(currentRoot.id !== selId) return; let newRoot = { id: Date.now(), name: "Yeni", surname: "Anne/Baba", gender: "male", title: "K√∂k", loc: "", note: "", birth: "", death: "", photos: [], isDeceased: false, spouse: null, children: [currentRoot] }; db.trees[currentTreeId][0] = newRoot; currentRoot.title = ""; selId = newRoot.id; doFinal(); }
    
    function openEdit() { 
        if(!selId) return; 
        
        let p=getType(selId,selType); 
        document.getElementById('m-name').value=p.name; document.getElementById('m-surname').value=p.surname||""; document.getElementById('m-gender').value=p.gender||"male"; document.getElementById('m-title').value=p.title||""; document.getElementById('m-loc').value=p.loc||""; document.getElementById('m-note').value=p.note||""; document.getElementById('m-birth').value=p.birth||""; document.getElementById('m-death').value=p.death||""; document.getElementById('m-dead').checked=p.isDeceased||false; 
        
        let pathPhoto = "";
        if(p.photos && p.photos.length > 0) {
            if(!p.photos[0].startsWith("data:image")) {
                pathPhoto = p.photos[0];
            }
        }
        document.getElementById('m-photo-path').value = pathPhoto;

        tempPhotos = p.photos ? [...p.photos] : (p.photo ? [p.photo] : []); 
        
        renderPhotoGallery(); 
        document.getElementById('modal').style.display='flex'; 
    }
    
    function renderPhotoGallery() { let c = document.getElementById('photo-gallery'); c.innerHTML = ""; tempPhotos.forEach((src, idx) => { let div = document.createElement('div'); div.className = 'mini-photo-wrapper'; div.innerHTML = `<img src="${src}" class="mini-photo"><div class="delete-mini" onclick="deleteMiniPhoto(${idx})">√ó</div>`; c.appendChild(div); }); document.getElementById('m-photo').style.display = tempPhotos.length >= 4 ? 'none' : 'block'; }
    document.getElementById('m-photo').addEventListener('change', function(e) { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = function(event) { if (tempPhotos.length < 4) { tempPhotos.push(event.target.result); renderPhotoGallery(); } else { alert("En fazla 4 fotoƒüraf."); } }; reader.readAsDataURL(file); } });
    function deleteMiniPhoto(idx) { tempPhotos.splice(idx, 1); renderPhotoGallery(); }
    
    function saveEdit() { 
        let p = getType(selId,selType); 
        p.name=document.getElementById('m-name').value; 
        p.surname=document.getElementById('m-surname').value; 
        p.gender=document.getElementById('m-gender').value; 
        p.title=document.getElementById('m-title').value; 
        p.loc=document.getElementById('m-loc').value; 
        p.note=document.getElementById('m-note').value; 
        p.birth=document.getElementById('m-birth').value; 
        p.death=document.getElementById('m-death').value; 
        p.isDeceased=document.getElementById('m-dead').checked; 
        
        let pathVal = document.getElementById('m-photo-path').value.trim();
        let finalPhotos = [...tempPhotos];
        if (pathVal && !finalPhotos.includes(pathVal)) {
            finalPhotos.push(pathVal);
        }
        p.photos = finalPhotos;

        delete p.photo; 
        doFinal(); 
        document.getElementById('modal').style.display='none'; 
    }
    
    function doFinal(){ try {  } catch(e) { console.log("Hafƒ±za limiti, RAM kullanƒ±lƒ±yor."); } refresh(); }
    function closeModal() { document.getElementById('modal').style.display='none'; }
    function addSpouse(){ let p=getP(selId,'main'); if(p.spouse && !confirm("E≈ü deƒüi≈üsin mi?")) return; p.spouse={id:Date.now(), name:"E≈ü", surname:"", gender:p.gender==='male'?'female':'male', photos:[]}; doFinal(); }
    function addChild(){ let p=getP(selId,'main'); p.children.push({id:Date.now(), name:"√áocuk", surname:"", gender:"male", photos:[], children:[]}); doFinal(); }
    function addSibling(){ let par=getParent(db.trees[currentTreeId][0], selId); if(!par) return; par.children.push({id:Date.now(), name:"Karde≈ü", surname:"", gender:"male", photos:[], children:[]}); doFinal(); }
    function findParent(node, id) { if (!node || !node.children) return null; for (let child of node.children) { if (child.id == id) return node; let found = findParent(child, id); if (found) return found; } return null; }
    function getParent(root, id) { return findParent(root, id); }
    function getP(id, t) { let n=find(db.trees[currentTreeId][0], id); return t==='main'?n:n.spouse; }
    function find(n, id) { if(n.id===id) return n; for(let c of n.children) { let f=find(c,id); if(f) return f; } return null; }
    function getType(id,type) { let n=find(db.trees[currentTreeId][0],id); return type==='main'?n:n.spouse; }
    function downloadData() { let a=document.createElement('a'); a.href='data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(db)); a.download='aile_yedek.json'; a.click(); }
    function uploadData(inp) { let r=new FileReader(); r.onload=e=>{try{let loaded = JSON.parse(e.target.result); if(loaded.trees) { db = loaded; 
        if(db.siteMessage) { document.getElementById('msg-input').value = db.siteMessage; updateMsg(db.siteMessage); } else { updateMsg(""); document.getElementById('msg-input').value = ""; }
        openTabs=[{id:'main',name:'Ana Sayfa'}]; loadTree('main'); centerTree(); alert("Y√ºklendi!"); } }catch(x){alert("Hata!");}}; r.readAsText(inp.files[0]); }
    function toggleDeadCheckbox() { let c=document.getElementById('m-dead'); c.checked=!c.checked; }
    function forceReset() { if(confirm("Her ≈üey silinecek?")) { localStorage.removeItem('aile_v110_final'); location.reload(); } }
    
    // --- Sƒ∞TEYƒ∞ HTML OLARAK ƒ∞NDƒ∞RME FONKSƒ∞YONU ---
    function generateShareFile() {
        document.getElementById('loading-overlay').style.display = 'flex';
        document.getElementById('loading-overlay').innerHTML = '<div style="font-size:40px;">üíæ</div><div style="margin-top:20px;">Site Olu≈üturuluyor...</div>';
        
        setTimeout(() => {
            const base64Data = btoa(unescape(encodeURIComponent(JSON.stringify(db))));
            let scriptContent = document.querySelector('script').innerHTML;
            
            // Script i√ßinde "updateMsg" ve "toggleMsg" fonksiyonunun indirilende de √ßalƒ±≈ümasƒ± i√ßin
            scriptContent = scriptContent.replace('const INITIAL_DATA', `const INITIAL_DATA`).replace(/localStorage\.setItem\(.*?\);/g, '').replace(/window\.onload\s*=\s*function\(\)\s*\{[\s\S]*?\};/, `window.onload = function() { try { let raw = "${base64Data}"; db = JSON.parse(decodeURIComponent(escape(atob(raw)))); } catch(e) { db = INITIAL_DATA; } if(db.siteMessage){ let box=document.getElementById('site-msg-display'); box.innerHTML='<button class="msg-close-btn" onclick="toggleMsg(false)">‚úï</button>'+db.siteMessage; box.style.display='block'; } setTimeout(function(){ loadTree('main'); centerTree(); }, 100); };`);
            
            const template = `<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Aile Aƒüacƒ±</title><style>${document.querySelector('style').innerHTML} #toolbar, #modal, #loading-overlay {display:none !important} /* ƒ∞ndirilen sitede mesaj varsa g√∂ster */ #site-msg-display { display: ${db.siteMessage ? 'block' : 'none'}; } #msg-reopen-btn { display: none; }</style></head><body><div id="tabs-container"></div><div id="site-msg-display"></div><button id="msg-reopen-btn" onclick="toggleMsg(true)">üí¨ Mesaj</button><div id="viewport"><div id="world"><div id="root" class="tree"></div></div></div><div id="bottom-bar"><button class="btn-focus" onclick="centerTree()">üéØ Merkeze D√∂n</button><label id="hand-mode-box"><input type="checkbox" id="hand-mode-toggle" onchange="toggleHandMode()">üñêÔ∏è Gezinme (El Modu)</label><span>üîç</span><input type="range" id="zoom-range" min="0.2" max="2.5" step="0.1" value="1"></div><div id="insta-overlay"><div id="insta-card"><button class="close-insta" onclick="document.getElementById('insta-overlay').style.display='none'">‚úï</button><div id="insta-img-area"><button class="slide-btn prev-btn" onclick="changeSlide(-1)">‚ùÆ</button><img id="insta-img" src=""><button class="slide-btn next-btn" onclick="changeSlide(1)">‚ùØ</button><div id="insta-dots" class="slide-dots"></div></div><div id="insta-info"></div></div></div><script>${scriptContent}<\/script></body></html>`;
            
            const blob = new Blob([template], {type: 'text/html'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'index.html'; document.body.appendChild(a); a.click(); document.body.removeChild(a); document.getElementById('loading-overlay').style.display = 'none';
        }, 2000);
    }
</script></body></html>